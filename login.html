<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Access Portal ‚Äì Sarvwigyan</title>
    <meta name="description" content="Log in to access Sarvwigyan's innovative educational platforms.">
    <meta name="keywords" content="Sarvwigyan Login, Education Platform, Sign In, Google Login">
    <meta name="author" content="Sarvwigyan Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://sarvwigyan.github.io/login.html" />
    <meta property="og:title" content="Login to Sarvwigyan">
    <meta property="og:description" content="Access your Sarvwigyan account to explore science, education, and innovation.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sarvwigyan.github.io/login.html">
    <meta property="og:image" content="https://sarvwigyan.github.io/Resources/Sarvwigyan.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" href="https://sarvwigyan.github.io/Resources/Sarvwigyan.png" type="image/png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        :root { --bg: #fafafa; --card: #ffffff; --text: #1a1a1a; --muted: #6b7280; --primary: #2563eb; --accent: #10b981; }
        [data-theme="dark"] { --bg: #1f1f1f; --card: #2d2d2d; --text: #f3f4f6; --muted: #9ca3af; --primary: #3b82f6; --accent: #34d399; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
        body { background:var(--bg); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center; }
        .login-container { background:var(--card); padding:3rem; border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,0.1); text-align:center; max-width:400px; width:90%; }
        .logo { width:90px; height:90px; background:linear-gradient(135deg,var(--primary),var(--accent)); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 1.5rem; }
        .logo i { color:white; font-size:48px; }
        h1 { font-size:1.9rem; margin-bottom:0.5rem; }
        p { color:var(--muted); margin-bottom:2rem; }
        .google-btn {
            background:#4285f4; color:white; border:none; padding:14px 32px; border-radius:12px; font-size:16px; font-weight:600;
            cursor:pointer; display:inline-flex; align-items:center; gap:12px; box-shadow:0 4px 15px rgba(66,133,244,0.4);
            transition:all 0.3s;
        }
        .google-btn:hover { background:#3367d6; transform:translateY(-2px); }
        .footer { margin-top:2rem; font-size:0.875rem; color:var(--muted); }
        @media (max-width:480px) { .login-container { padding:2rem; } h1 { font-size:1.6rem; } }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo"><i class="material-icons">lightbulb</i></div>
        <h1>Welcome to Sarvwigyan</h1>
        <p>Sign in with Google to continue</p>
        <button onclick="signInWithGoogle()" class="google-btn">
            <i class="fab fa-google"></i> Sign in with Google
        </button>
        <!-- Temporary debug button - remove after testing -->
<button onclick="checkFirestore()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #666; color: white; border: none; border-radius: 8px; cursor: pointer;">
    Debug: Check Firestore
</button>

<script>
async function checkFirestore() {
    try {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js');
        const { getAuth } = await import('https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js');
        const { getFirestore, doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js');
        
        const firebaseConfig = {
            apiKey: "AIzaSyCIGRKHyP60pqyrmoERdWqnO6vCTGT4JsI",
            authDomain: "sarvwigyan-auth.firebaseapp.com",
            projectId: "sarvwigyan-auth",
            storageBucket: "sarvwigyan-auth.firebasestorage.app",
            messagingSenderId: "503809453858",
            appId: "1:503809453858:web:8507f6c59d854a67f57f7b",
            measurementId: "G-BV5G1LSH6F"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const user = auth.currentUser;
        
        if (user) {
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                console.log("üìä Firestore User Data:", userDoc.data());
                alert("Firestore data found! Check console for details.");
            } else {
                console.log("‚ùå No Firestore data found for user:", user.uid);
                alert("No Firestore data found for current user.");
            }
        } else {
            alert("No user logged in.");
        }
    } catch (error) {
        console.error("Debug error:", error);
        alert("Debug check failed: " + error.message);
    }
}
</script>
        <div class="footer"><p>¬© 2025 Sarvwigyan. All rights reserved.</p></div>
    </div>

    <!-- Firebase SDK (modular) -->
    <script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
import { getAuth, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js';
import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';

const firebaseConfig = {
    apiKey: "AIzaSyCIGRKHyP60pqyrmoERdWqnO6vCTGT4JsI",
    authDomain: "sarvwigyan-auth.firebaseapp.com",
    projectId: "sarvwigyan-auth",
    storageBucket: "sarvwigyan-auth.firebasestorage.app",
    messagingSenderId: "503809453858",
    appId: "1:503809453858:web:8507f6c59d854a67f57f7b",
    measurementId: "G-BV5G1LSH6F"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

provider.setCustomParameters({ prompt: 'select_account' });

window.signInWithGoogle = async () => {
    try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        console.log("Google User Info:", user); // Debug log

        // Prepare complete user data for Firestore
        const userData = {
            // Basic info
            uid: user.uid,
            displayName: user.displayName,
            email: user.email,
            photoURL: user.photoURL,
            emailVerified: user.emailVerified,
            phoneNumber: user.phoneNumber || 'Not provided',
            
            // Google metadata
            providerData: user.providerData ? user.providerData.map(provider => ({
                providerId: provider.providerId,
                uid: provider.uid,
                displayName: provider.displayName,
                email: provider.email,
                phoneNumber: provider.phoneNumber,
                photoURL: provider.photoURL
            })) : [],
            
            // Account timestamps
            metadata: {
                creationTime: user.metadata.creationTime,
                lastSignInTime: user.metadata.lastSignInTime
            },
            
            // Additional profile info
            profile: {
                fullName: user.displayName,
                location: 'Not specified',
                bio: 'Technology enthusiast and lifelong learner. Passionate about AI, web development, and open-source projects. Currently working on building innovative solutions at Sarvwigyan.',
                phone: user.phoneNumber || 'Not provided'
            },
            
            // User stats
            stats: {
                projects: Math.floor(Math.random() * 20) + 1,
                connections: Math.floor(Math.random() * 100) + 1,
                activity: Math.floor(Math.random() * 30) + 70
            },
            
            // Security settings
            security: {
                twoFactorEnabled: false,
                securityStatus: 'strong',
                passwordChanged: 'Never (Google Auth)',
                lastLogin: new Date().toISOString()
            },
            
            // Preferences
            preferences: {
                theme: 'System default',
                language: 'English',
                notifications: 'All notifications',
                emailFrequency: 'Weekly digest'
            },
            
            // System fields
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            lastLoginAt: new Date().toISOString()
        };

        // Save to Firestore - use setDoc with merge: true to update existing or create new
        try {
            await setDoc(doc(db, "users", user.uid), userData, { merge: true });
            console.log("‚úÖ User data saved to Firestore successfully!");
            console.log("Firestore Document ID:", user.uid);
            console.log("Firestore Data:", userData);
        } catch (firestoreError) {
            console.error("‚ùå Firestore save error:", firestoreError);
            console.error("Error details:", firestoreError.message, firestoreError.code);
        }

        // Prepare data for localStorage (simplified version)
        const localStorageUser = {
            // Core identifiers
            userId: user.uid,
            name: user.displayName,
            email: user.email,
            picture: user.photoURL,
            
            // Profile info
            fullName: user.displayName,
            accountCreated: user.metadata.creationTime,
            lastLogin: new Date().toISOString(),
            passwordChanged: 'Never (Google Auth)',
            phoneNumber: user.phoneNumber || 'Not provided',
            location: 'Not specified',
            bio: 'Technology enthusiast and lifelong learner. Passionate about AI, web development, and open-source projects. Currently working on building innovative solutions at Sarvwigyan.',
            
            // Stats
            stats: userData.stats,
            
            // Security
            twoFactorEnabled: false,
            securityStatus: 'strong',
            
            // Preferences
            themePreference: 'System default',
            languagePreference: 'English',
            notificationSettings: 'All notifications'
        };
        
        localStorage.setItem('user', JSON.stringify(localStorageUser));
        console.log("‚úÖ LocalStorage updated");

        // Redirect to home
        setTimeout(() => {
            window.location.href = "index.html";
        }, 1000);

    } catch (error) {
        console.error("‚ùå Login error:", error);
        alert("Login failed: " + error.message);
    }
};

// Auto-redirect if already logged in
auth.onAuthStateChanged(user => {
    if (user) {
        console.log("User already logged in, redirecting...");
        window.location.href = "index.html";
    }
});
</script>
</body>
</html>